<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>How Gmail came to stop supporting CSS animations</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">How Gmail came to stop supporting CSS animations</h1>
</header>
<section data-field="subtitle" class="p-summary">
Did you know that not so long ago, Gmail supported CSS animations? Well, sort of. Up until June 2016, the desktop webmail of Gmail…
</section>
<section data-field="body" class="e-content">
<section name="0d7b" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="faf3" id="faf3" class="graf graf--h3 graf--leading graf--title">How Gmail came to stop supporting CSS animations</h3><p name="3691" id="3691" class="graf graf--p graf-after--h3">Did you know that not so long ago, Gmail supported CSS animations? Well, sort of. Up until June 2016, the desktop webmail of Gmail supported CSS <code class="markup--code markup--p-code">@keyframes</code> declarations. So you could declare the following animation in a <code class="markup--code markup--p-code">&lt;style&gt;</code> tag in the <code class="markup--code markup--p-code">&lt;head&gt;</code> of your email, and Gmail would keep it intact.</p><pre name="5d28" id="5d28" class="graf graf--pre graf-after--p">@keyframes <strong class="markup--strong markup--pre-strong">foo</strong> {<br> from { background:red; }<br> to { background:black; }<br>}</pre><p name="6c7b" id="6c7b" class="graf graf--p graf-after--pre">The problem is that, in itself, such a declaration is useless. In order to call an animation in CSS, you need the actual <code class="markup--code markup--p-code">animation</code> CSS property.</p><pre name="8df8" id="8df8" class="graf graf--pre graf-after--p">&lt;div style=&quot;animation:<strong class="markup--strong markup--pre-strong">foo</strong> linear 1s;&quot;&gt;&lt;/div&gt;</pre><p name="bfa3" id="bfa3" class="graf graf--p graf-after--pre">But Gmail didn’t support the <code class="markup--code markup--p-code">animation</code> property. So that was all pretty pointless. I shared <a href="https://twitter.com/search?l=&amp;q=keyframes%20from%3Ahteumeuleu&amp;src=typd" data-href="https://twitter.com/search?l=&amp;q=keyframes%20from%3Ahteumeuleu&amp;src=typd" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">my frustration a few times on Twitter</a>, without thinking too much about it.</p><p name="8eb1" id="8eb1" class="graf graf--p graf-after--p">Later that year, in may of 2016, I was fiddling around in Gmail <a href="https://emails.hteumeuleu.com/trying-to-make-sense-of-gmail-css-support-e88cd7995cea" data-href="https://emails.hteumeuleu.com/trying-to-make-sense-of-gmail-css-support-e88cd7995cea" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">trying to make sense of its CSS support</a>. And I realized that instead of being pointless, the <code class="markup--code markup--p-code">@keyframes</code> support could be a real security issue.</p><p name="36c2" id="36c2" class="graf graf--p graf-after--p">Because Gmail was not just supporting CSS <code class="markup--code markup--p-code">@keyframes</code> declarations. It was keeping the name of the declaration <em class="markup--em markup--p-em">intact</em>. This meant that, theoretically, you could override any CSS animation that the webmail used. And while Gmail is pretty sober in terms of visible animations, it still uses quite a few.</p><p name="2031" id="2031" class="graf graf--p graf-after--p">I wrote <a href="https://gist.github.com/hteumeuleu/89e93c95b08bf85e72a2fa59b936fd33" data-href="https://gist.github.com/hteumeuleu/89e93c95b08bf85e72a2fa59b936fd33" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a small script</a> to get all the elements that have an <code class="markup--code markup--p-code">animation</code> style, and got a dozen of result. Those animations were referencing about as much <code class="markup--code markup--p-code">@keyframes</code> declarations. Most of these animations were only called during very specific actions in the interface of Gmail, outside of an email view. But one of them, named <code class="markup--code markup--p-code">gb__a</code>, was quite interesting.</p><pre name="e7ab" id="e7ab" class="graf graf--pre graf-after--p">@keyframes gb__a {<br> 0%  { opacity:0 }<br> 50% { opacity:1 }<br>}</pre><p name="c7c8" id="c7c8" class="graf graf--p graf-after--pre">This animation uses the <code class="markup--code markup--p-code">opacity</code> property to create a fading effect. It is used in the upper right hand corner of Gmail when you open the little pop ups with your app, your notifications or your account information.</p><figure name="501a" id="501a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 200px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 28.599999999999998%;"></div><img class="graf-image" data-image-id="1*-4229OB3ZEz0aRvoHMXDWQ.gif" data-width="700" data-height="200" src="https://cdn-images-1.medium.com/max/800/1*-4229OB3ZEz0aRvoHMXDWQ.gif"></div><figcaption class="imageCaption">A fade in animation when you click on “Your notification” in the top right hand of Gmail. In practice, this animation only lasts 0.2 second, so you might have never even noticed it.</figcaption></figure><p name="a3d0" id="a3d0" class="graf graf--p graf-after--figure">This was perfect! This meant that for the split moment this animation was playing, I could apply any styles that Gmail allowed. I could change the width and height of that element, change its background color, and apply a background image to display some content.</p><p name="94f6" id="94f6" class="graf graf--p graf-after--p">At that moment, I knew that what I found was pretty serious. Having read other stories of email security like <a href="http://freshinbox.com/blog/how-i-helped-make-office-365-a-little-safer/" data-href="http://freshinbox.com/blog/how-i-helped-make-office-365-a-little-safer/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">this one by Justin Khoo</a>, I was definitely willing to report this. Turns out Google has a handy and memorable URL to report vulnerabilities: <a href="http://goo.gl/vulnz" data-href="http://goo.gl/vulnz" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">goo.gl/vulnz</a>. After reading tips from Google to <a href="https://sites.google.com/site/bughunteruniversity/improve" data-href="https://sites.google.com/site/bughunteruniversity/improve" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">write a good bug report</a> (and <a href="https://sites.google.com/site/bughunteruniversity/nonvuln" data-href="https://sites.google.com/site/bughunteruniversity/nonvuln" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">what doesn’t qualify as a bug</a>), I <a href="https://gist.github.com/hteumeuleu/87a0d296648bea3488416f2ad04b9f31#file-gmail-animation-hack" data-href="https://gist.github.com/hteumeuleu/87a0d296648bea3488416f2ad04b9f31#file-gmail-animation-hack" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">made a prototype of an email</a> to show how the vulnerability could be exploited. I imitated Google’s email design to make a somewhat convincing notification email inviting a recipient to click on the top right hand icons.</p><figure name="ca7d" id="ca7d" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 472px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 67.4%;"></div><img class="graf-image" data-image-id="1*esJGwP-r0kreOZ5Uu9y9mw.png" data-width="700" data-height="472" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*esJGwP-r0kreOZ5Uu9y9mw.png"></div><figcaption class="imageCaption">The email I sent to Google along my Vulnerability Report.</figcaption></figure><p name="78bd" id="78bd" class="graf graf--p graf-after--figure">And if you clicked on any of the top right icons, here’s what you would see.</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="57a3" id="57a3" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1192px; max-height: 669px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.2%;"></div><img class="graf-image" data-image-id="1*-xeXnIMvlKiO_zYjCNvWgQ.gif" data-width="1412" data-height="793" src="https://cdn-images-1.medium.com/max/1200/1*-xeXnIMvlKiO_zYjCNvWgQ.gif"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="eeb6" id="eeb6" class="graf graf--p graf-after--figure">I reported this on May 20, 2016, and immediately received an automated response. Three days later, I got a personal response from a Google employee that they were looking into it. Two days after, I received another personal response asking me to send the test email to a specific address.</p><p name="a64f" id="a64f" class="graf graf--p graf-after--p">And then, on June 7, I received the following email:</p><blockquote name="08a2" id="08a2" class="graf graf--blockquote graf-after--p">Hello,</blockquote><blockquote name="cee0" id="cee0" class="graf graf--blockquote graf-after--blockquote">Thank you for reporting this bug. As part of Google’s Vulnerability Reward Program, the panel has decided to issue a reward of $1337.</blockquote><blockquote name="dd23" id="dd23" class="graf graf--blockquote graf-after--blockquote">[…]</blockquote><blockquote name="2a87" id="2a87" class="graf graf--blockquote graf-after--blockquote">Regards,<br>Google Security Bot</blockquote><p name="d7e2" id="d7e2" class="graf graf--p graf-after--blockquote">That was such a pleasant surprise. This is still to this day probably one of my proudest email geek achievement.</p><p name="ad66" id="ad66" class="graf graf--p graf-after--p graf--trailing">A few days later, Gmail started filtering all <code class="markup--code markup--p-code">@keyframes</code> declarations. And that’s how Gmail came to stop supporting CSS animations.</p></div></div></section><section name="cc3a" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="4de5" id="4de5" class="graf graf--p graf--leading">I wanted to tell this story two years after because I think it’s still a good example how important security is in the email world.</p><ul class="postList"><li name="3766" id="3766" class="graf graf--li graf-after--p">Google is taking Gmail security very seriously. This is visible at multiple levels, from their <a href="https://goo.gl/vulnz" data-href="https://goo.gl/vulnz" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">memorable report URL</a> to their financial reward. My experience with Google has been in huge contrast to <a href="https://emails.hteumeuleu.com/thinking-outside-the-table-at-tedc16-a58a76c7c625#0f95" data-href="https://emails.hteumeuleu.com/thinking-outside-the-table-at-tedc16-a58a76c7c625#0f95" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">one of my previous experience</a> with another email client where I was almost laughed at for much more serious issues. If you’re an email client maker, you should <em class="markup--em markup--li-em">want</em> the good guys (and girls) to report an issue. So you should make everything in your power to make reporting bugs easy and attractive so that people <em class="markup--em markup--li-em">want</em> to take some of their time to report you an issue.</li><li name="18c6" id="18c6" class="graf graf--li graf-after--li graf--trailing">In a webmail, a lot of CSS features can become vulnerabilities. There’s a good chance that CSS <code class="markup--code markup--li-code">@keyframes</code> didn’t even exist at the time Gmail’s parser was written. This doesn’t mean that <code class="markup--code markup--li-code">@keyframes</code> and <code class="markup--code markup--li-code">animation</code> can’t be supported safely in a webmail. But a webmail should always be cautious about what they support. Thus, a restrictive black list (that only allows a subset of styles) is still the best way to go. We might never see the same level of support of CSS in emails than on the Web, and it’s probably a good thing.</li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@hteumeuleu" class="p-author h-card">Rémi Parmentier</a> on <a href="https://medium.com/p/4e6fd81f1b75"><time class="dt-published" datetime="2018-02-23T15:07:02.681Z">February 23, 2018</time></a>.</p><p><a href="https://medium.com/@hteumeuleu/how-gmail-came-to-stop-supporting-css-animations-4e6fd81f1b75" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 9, 2020.</p></footer></article></body></html>