---
title:  "Troubleshooting Gmail’s responsive design support"
date:   2017-01-05 13:00:04 +0200
---
<section name="44b7" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="a0f9" id="a0f9" class="graf graf--h3 graf--leading graf--title">Troubleshooting Gmail’s responsive design support</h3><p name="f341" id="f341" class="graf graf--p graf-after--h3">Gmail had its <a href="https://gsuite-developers.googleblog.com/2016/09/your-emails-optimized-for-every-screen-with-responsive-design.html" data-href="https://gsuite-developers.googleblog.com/2016/09/your-emails-optimized-for-every-screen-with-responsive-design.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">biggest update ever</a> last year, adding responsive design and media queries support. But there seems to be a lot of recurring questions from email developers having trouble to make responsive emails work in Gmail.</p><p name="6a24" id="6a24" class="graf graf--p graf-after--p">Here are seven things to keep in mind to tame Gmail’s responsive support.</p><h3 name="2204" id="2204" class="graf graf--h3 graf-after--p">1. Which version of Gmail are you using?</h3><p name="fef4" id="fef4" class="graf graf--p graf-after--h3">Gmail CSS support depends on various factors. I wrote about this in detail when <a href="https://emails.hteumeuleu.com/trying-to-make-sense-of-gmail-css-support-after-the-2016-update-53c15151063a#.h357u7996" data-href="https://emails.hteumeuleu.com/trying-to-make-sense-of-gmail-css-support-after-the-2016-update-53c15151063a#.h357u7996" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">trying to make sense of Gmail CSS support</a>. The gist of it is that you should expect responsive design to work in all versions of Gmail, <em class="markup--em markup--p-em">except</em> the mobile webmail, Google Apps Free Edition, and GANGA (Gmail Android with a Non Gmail Account).</p><p name="20b4" id="20b4" class="graf graf--p graf-after--p">If you want a mobile optimized email on those versions of Gmail, it’s better to opt for <a href="http://labs.actionrocket.co/the-hybrid-coding-approach" data-href="http://labs.actionrocket.co/the-hybrid-coding-approach" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a fluid/hybrid solution</a> or <a href="https://webdesign.tutsplus.com/tutorials/creating-a-future-proof-responsive-email-without-media-queries--cms-23919" data-href="https://webdesign.tutsplus.com/tutorials/creating-a-future-proof-responsive-email-without-media-queries--cms-23919" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a responsive email without media queries</a> approach .</p><h3 name="39d7" id="39d7" class="graf graf--h3 graf-after--p">2. Are you up to date?</h3><p name="53dc" id="53dc" class="graf graf--p graf-after--h3">The desktop webmails and Android app did not require an update to add responsive design support as all was done server side. The Android app, though, might require a full reboot of your device or some cache cleaning in case you tried to see the update in an email you’ve seen before.</p><p name="a782" id="a782" class="graf graf--p graf-after--p">The iOS app, however, requires a full update that was <a href="https://blog.google/products/gmail/gmail-and-google-calendar-get-a-whole-lot-better-on-ios/" data-href="https://blog.google/products/gmail/gmail-and-google-calendar-get-a-whole-lot-better-on-ios/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">released on November, 7th 2016</a>. So make sure you’re on version 5.0.0 or above of Gmail on iOS. (You can see your version number in the Settings app on iOS.)</p><figure name="dd43" id="dd43" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 320px; max-height: 380px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 118.8%;"></div><img class="graf-image" data-image-id="1*HyOuFHA2hZn3b3d8LaLupw.png" data-width="320" data-height="380" src="https://cdn-images-1.medium.com/max/800/1*HyOuFHA2hZn3b3d8LaLupw.png"></div><figcaption class="imageCaption">Gmail settings on iOS 10.</figcaption></figure><h3 name="f669" id="f669" class="graf graf--h3 graf-after--figure">3. Are you using attribute selectors?</h3><p name="2cf4" id="2cf4" class="graf graf--p graf-after--h3">Attribute selectors in CSS were very common in responsive email templates in a not so distant past, especially within media queries.</p><pre name="d548" id="d548" class="graf graf--pre graf-after--p">@media only screen and (min-width:480px) {<br>  div[class=&quot;column&quot;] { width: 50%; }<br>}</pre><p name="7405" id="7405" class="graf graf--p graf-after--pre">Until march 2015, <a href="http://freshinbox.com/blog/yahoo-mail-fixes-media-query-bug-yahoo/" data-href="http://freshinbox.com/blog/yahoo-mail-fixes-media-query-bug-yahoo/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Yahoo had a media query bug</a> where it would incorrectly parse media queries, pushing CSS rules outside of their intended media queries and thus applying for every Yahoo user. A hack found at the time was to turn all CSS selectors inside media queries into attributes selectors (like <code class="markup--code markup--p-code">[class=&quot;foo&quot;] { }</code> instead of <code class="markup--code markup--p-code">.foo { }</code>). Because it didn’t support attribute selectors, Yahoo would then filter out these rules. This bug was fixed by Yahoo, but many email templates haven’t been updated since then and still include attribute selectors.</p><p name="0629" id="0629" class="graf graf--p graf-after--p">Gmail doesn’t support attribute selectors, period. So make sure your code doesn’t contain any, or Gmail will filter them out.</p><h3 name="d722" id="d722" class="graf graf--h3 graf-after--p">4. Do you have a lot of styles?</h3><p name="fb08" id="fb08" class="graf graf--p graf-after--h3">With last year update, Gmail supports up to 8192 bytes of styles. (And this has been recently updated to 16384 bytes according to <a href="https://twitter.com/ericlepetitsf" data-href="https://twitter.com/ericlepetitsf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Eric Lepetit</a> on the <a href="https://email.geeks.chat/" data-href="https://email.geeks.chat/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Emailgeeks Slack</a>.) Gmail will only keep the styles rules before that limit. Try to divide your code into multiple <code class="markup--code markup--p-code">&lt;style&gt;</code> tags and make sure the most important ones appear first in your code.</p><h3 name="018d" id="018d" class="graf graf--h3 graf-after--p">5. Do you have an @ within an @ ?</h3><p name="c5dd" id="c5dd" class="graf graf--p graf-after--h3">Gmail removes <code class="markup--code markup--p-code">&lt;style&gt;</code> tags that contain an <code class="markup--code markup--p-code">@</code> declaration within an <code class="markup--code markup--p-code">@</code> declaration. This can often be found in emails in two cases.</p><ul class="postList"><li name="715a" id="715a" class="graf graf--li graf-after--p">When declaring a <strong class="markup--strong markup--li-strong">web font</strong>. <a href="http://www.emaildesignreview.com/html-email-coding/web-fonts-in-email-1482/" data-href="http://www.emaildesignreview.com/html-email-coding/web-fonts-in-email-1482/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">One of the recommended ways</a> to embed a web font within an email is to import inside a <code class="markup--code markup--li-code">@media</code> query to prevent Outlook 2007 and above to convert all fonts to Times.</li></ul><pre name="7cff" id="7cff" class="graf graf--pre graf-after--li">@media {<br>  @font-face {<br>    font-family: &#39;Proxima Nova Regular&#39;;<br>    src: url(&#39;proximanova-regular-webfont.woff&#39;) format(&#39;woff&#39;),<br>    url(&#39;proximanova-regular-webfont.ttf&#39;) format(&#39;truetype&#39;);<br>    font-weight: normal;<br>    font-style: normal;<br>  }<br>}</pre><ul class="postList"><li name="7d84" id="7d84" class="graf graf--li graf-after--pre">When declaring a <strong class="markup--strong markup--li-strong">viewport</strong> for Windows Phone 8.1. The default email client on Windows Phone 8.1 does <a href="https://remi-grumeau.com/blog/2495-emails-responsive-viewport-ya-du-nouveau/" data-href="https://remi-grumeau.com/blog/2495-emails-responsive-viewport-ya-du-nouveau/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">support responsive design and media queries</a>. But you need to include a <code class="markup--code markup--li-code">&lt;meta http-equiv=&quot;X-UA-Compatible&quot;&gt;</code>, <em class="markup--em markup--li-em">and</em> define a viewport in CSS using an <code class="markup--code markup--li-code">@viewport</code> declaration.</li></ul><pre name="abda" id="abda" class="graf graf--pre graf-after--li">@media only screen and (max-width:480px) {<br>  @-ms-viewport { width:320px; }<br>  @viewport { width:320px; }<br>}</pre><p name="dbec" id="dbec" class="graf graf--p graf-after--pre">If you have such declarations in your code, put them in their own <code class="markup--code markup--p-code">&lt;style&gt;</code> tags. This way, only those <code class="markup--code markup--p-code">&lt;style&gt;</code> tags will be filtered by Gmail, and the rest will be kept.</p><h3 name="a9a5" id="a9a5" class="graf graf--h3 graf-after--p">6. Are your styles valid?</h3><p name="8fad" id="8fad" class="graf graf--p graf-after--h3">Gmail’s CSS parser is very, <em class="markup--em markup--p-em">very</em> sensitive. Any extra special character might trigger it to completely filter out styles (may they be inline or in a <code class="markup--code markup--p-code">&lt;style&gt;</code> tag. For example, the following example…</p><pre name="dbd7" id="dbd7" class="graf graf--pre graf-after--p">&lt;div style=&quot;background:#3cbc67; font-size:3*px;&quot;&gt;foo&lt;/div&gt;</pre><p name="f9a2" id="f9a2" class="graf graf--p graf-after--pre">…is transformed by Gmail into:</p><pre name="af94" id="af94" class="graf graf--pre graf-after--p">&lt;div&gt;foo&lt;/div&gt;</pre><p name="e3b4" id="e3b4" class="graf graf--p graf-after--pre">Did you notice the <code class="markup--code markup--p-code">*</code> character in the first declaration? Of course this looks like a straight up mistake, but this kind of thing can happen if you mess up a copy and paste, a code refactoring or if you’re a bit too tired.</p><p name="3f8d" id="3f8d" class="graf graf--p graf-after--p">(Cascading Style)sh*t happens.</p><p name="80e1" id="80e1" class="graf graf--p graf-after--p">And this can happen too for purposeful styles. For example, an old technique to target Internet Explorer (from versions 6 up to 9) consisted of adding a <code class="markup--code markup--p-code">\9</code> at the end of a property. Any inline <code class="markup--code markup--p-code">style</code> attribute or <code class="markup--code markup--p-code">&lt;style&gt;</code> tag containing this (like the following example), will be completely removed in Gmail.</p><pre name="3464" id="3464" class="graf graf--pre graf-after--p">&lt;style&gt;<br>  .foo { background:#3cbc67; }<br>  .bar { color:#fff; color:red\9; }<br>&lt;/style&gt;</pre><p name="9132" id="9132" class="graf graf--p graf-after--pre"><a href="https://github.com/hteumeuleu/email-bugs/issues/19" data-href="https://github.com/hteumeuleu/email-bugs/issues/19" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">From my tests</a>, any of the following characters misplaced in a style block can make Gmail become crazy: <code class="markup--code markup--p-code">=</code>, <code class="markup--code markup--p-code">*</code>, <code class="markup--code markup--p-code">/</code>, <code class="markup--code markup--p-code">$</code>, <code class="markup--code markup--p-code">%</code>, <code class="markup--code markup--p-code">\</code>, <code class="markup--code markup--p-code">&amp;</code>, <code class="markup--code markup--p-code">@</code>, <code class="markup--code markup--p-code">^</code>, <code class="markup--code markup--p-code">{</code>, <code class="markup--code markup--p-code">}</code>, <code class="markup--code markup--p-code">[</code>, <code class="markup--code markup--p-code">]</code>, <code class="markup--code markup--p-code">(</code>, <code class="markup--code markup--p-code">)</code>, <code class="markup--code markup--p-code">?</code>, <code class="markup--code markup--p-code">|</code>, <code class="markup--code markup--p-code">&lt;</code>, <code class="markup--code markup--p-code">&gt;</code>.</p><p name="7855" id="7855" class="graf graf--p graf-after--p">As far as possible, <a href="https://jigsaw.w3.org/css-validator/" data-href="https://jigsaw.w3.org/css-validator/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">try to validate your CSS code</a>. And once again, divide your code into multiple <code class="markup--code markup--p-code">&lt;style&gt;</code> tags.</p><h3 name="de8f" id="de8f" class="graf graf--h3 graf-after--p">7. Did you just turn on images display?</h3><p name="df11" id="df11" class="graf graf--p graf-after--h3">At last, <a href="https://github.com/hteumeuleu/email-bugs/issues/24" data-href="https://github.com/hteumeuleu/email-bugs/issues/24" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here’s a crazy bug</a> found by <a href="https://twitter.com/M_J_Robbins" data-href="https://twitter.com/M_J_Robbins" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Mark Robbins</a> shortly after the Gmail update last year. On the desktop webmail of Gmail, when Gmail is set up to “Ask before displaying external images”, a banner with “Images are not displayed” appears on top of an email with a link to “Display images below”.</p><figure name="3cba" id="3cba" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 101px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 14.399999999999999%;"></div><img class="graf-image" data-image-id="1*6N4NLy0D4bgMZU7DjsR32Q.png" data-width="731" data-height="105" src="https://cdn-images-1.medium.com/max/800/1*6N4NLy0D4bgMZU7DjsR32Q.png"></div></figure><p name="8e30" id="8e30" class="graf graf--p graf-after--figure">When you click on the “Display images below” link, the HTML code of your email will be reparsed but with a different prefix than the one used in the CSS. Thus, CSS rules no longer match the HTML, and emails might appear broken. For example, with images off, the following example…</p><pre name="6310" id="6310" class="graf graf--pre graf-after--p">&lt;style&gt;<br>  .foo { background:#39b54a; }<br>&lt;/style&gt;<br>&lt;p class=&quot;foo&quot;&gt;<br>  Lorem ipsum dolor sit amet, consectetur adipisicing elit.<br>&lt;/p&gt;<br>&lt;img src=&quot;spacer.gif&quot; alt=&quot;This image is blocked.&quot; /&gt;</pre><p name="ea5c" id="ea5c" class="graf graf--p graf-after--pre">…is transformed by Gmail into:</p><pre name="5ee7" id="5ee7" class="graf graf--pre graf-after--p">&lt;div class=&quot;m159215f7d36ee7fd&quot;&gt;<br>  &lt;style&gt;<br>    div.m159215f7d36ee7fd .m_3567455155959655244foo { background:#39b54a; }<br>  &lt;/style&gt;<br>  &lt;p class=&quot;m_3567455155959655244foo&quot;&gt;<br>    Lorem ipsum dolor sit amet, consectetur adipisicing elit.<br>  &lt;/p&gt;<br>  &lt;img alt=&quot;This image is blocked.&quot; /&gt;<br>&lt;/div&gt;</pre><p name="37b4" id="37b4" class="graf graf--p graf-after--pre">Once you click on the “Display images below” link, the code is turned into the following:</p><pre name="161a" id="161a" class="graf graf--pre graf-after--p">&lt;div class=&quot;m159215f7d36ee7fd&quot;&gt;<br>  &lt;style&gt;<br>    div.m159215f7d36ee7fd .m_3567455155959655244foo { background:#39b54a; }<br>  &lt;/style&gt;<br>  &lt;p class=&quot;<strong class="markup--strong markup--pre-strong">m_-8249599400804587256foo</strong>&quot;&gt;<br>    Lorem ipsum dolor sit amet, consectetur adipisicing elit.<br>  &lt;/p&gt;<br>  &lt;img alt=&quot;This image is blocked.&quot; /&gt;<br>&lt;/div&gt;</pre><p name="0c5a" id="0c5a" class="graf graf--p graf-after--pre graf--trailing">The prefix added to the <code class="markup--code markup--p-code">foo</code> class on the <code class="markup--code markup--p-code">&lt;p&gt;</code> tag has changed, but only on the tag itself, and not on the <code class="markup--code markup--p-code">&lt;style&gt;</code> tag.</p></div></div></section><section name="8058" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="d407" id="d407" class="graf graf--p graf--leading graf--trailing">The <em class="markup--em markup--p-em">new</em> Gmail is certainly better than the <em class="markup--em markup--p-em">old</em> one, CSS wise. But there’s still a lot of features and bugs that makes it difficult to apprehend for any newcomer. Have you found any other bug in Gmail? Let me know in the comments.</p></div></div></section>
</section>