<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The trap of using @supports in emails</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">The trap of using @supports in emails</h1>
</header>
<section data-field="subtitle" class="p-summary">
@supports is basically like a media query to test support for CSS features. The W3C specification actually calls it feature query. It has…
</section>
<section data-field="body" class="e-content">
<section name="2af5" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c718" id="c718" class="graf graf--h3 graf--leading graf--title">The trap of using @supports in emails</h3><p name="8740" id="8740" class="graf graf--p graf-after--h3"><code class="markup--code markup--p-code">@supports</code> is basically like a media query to test support for CSS features. <a href="https://www.w3.org/TR/css3-conditional/#at-supports" data-href="https://www.w3.org/TR/css3-conditional/#at-supports" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">The W3C specification</a> actually calls it <em class="markup--em markup--p-em">feature query. </em>It has been around for a while in web development, ever since around 2013. And it is now <a href="http://caniuse.com/#search=%40supports" data-href="http://caniuse.com/#search=%40supports" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">available in pretty much every modern browser</a>.</p><p name="040f" id="040f" class="graf graf--p graf-after--p">But what about<code class="markup--code markup--p-code">@supports</code> in HTML emails? Here are a few things I learnt.</p><h3 name="51ca" id="51ca" class="graf graf--h3 graf-after--p">About <code class="markup--code markup--h3-code">@supports</code></h3><p name="30a7" id="30a7" class="graf graf--p graf-after--h3">The syntax for feature queries is very similar to media queries. So let’s say you want to adjust your code for a rendering engine that supports CSS blend modes, you can use the following code.</p><pre name="b640" id="b640" class="graf graf--pre graf-after--p">@supports (mix-blend-mode: multiply) {<br> .fx {<br>  mix-blend-mode: multiply;<br> }<br>}</pre><p name="ce73" id="ce73" class="graf graf--p graf-after--pre">This is really great for progressive enhancement. <code class="markup--code markup--p-code">@supports</code> also features a <code class="markup--code markup--p-code">not</code> operator, so you can target rendering engines that don’t support a certain CSS feature. <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/%40supports" data-href="https://developer.mozilla.org/en-US/docs/Web/CSS/%40supports" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">MDN’s documentation on </a><code class="markup--code markup--p-code"><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/%40supports" data-href="https://developer.mozilla.org/en-US/docs/Web/CSS/%40supports" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@supports</a></code> is really great to dive deeper on the subject.</p><h3 name="3ac4" id="3ac4" class="graf graf--h3 graf-after--p">Email clients with <code class="markup--code markup--h3-code">@supports</code> support</h3><p name="2f14" id="2f14" class="graf graf--p graf-after--h3">I ran <a href="https://gist.github.com/hteumeuleu/520b9d295ab8730fe443db431704102a" data-href="https://gist.github.com/hteumeuleu/520b9d295ab8730fe443db431704102a" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a naive test</a> <a href="https://www.emailonacid.com/app/acidtest/7z6CVkJYQ5bj3ooJgiR9ecAYriIdtQ2imW9haTkGrZttX/list" data-href="https://www.emailonacid.com/app/acidtest/7z6CVkJYQ5bj3ooJgiR9ecAYriIdtQ2imW9haTkGrZttX/list" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">through Email on Acid</a>. And here are some email clients that do support <code class="markup--code markup--p-code">@supports</code> :</p><ul class="postList"><li name="1ce8" id="1ce8" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Apple Mail</strong> on macOS and iOS (ever since iOS 9)</li><li name="5bdf" id="5bdf" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Outlook 2011</strong> and <strong class="markup--strong markup--li-strong">Outlook 2016</strong> on <strong class="markup--strong markup--li-strong">macOS</strong> (Not on Windows. Don’t even dream about it.)</li><li name="2586" id="2586" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Thunderbird</strong></li><li name="bf67" id="bf67" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">AOL</strong>’s desktop webmail (in supporting browsers)</li><li name="e79e" id="e79e" class="graf graf--li graf-after--li">The french webmails of <strong class="markup--strong markup--li-strong">Free.fr</strong> (Zimbra), <strong class="markup--strong markup--li-strong">Orange.fr</strong> and <strong class="markup--strong markup--li-strong">SFR.fr</strong></li><li name="6dd1" id="6dd1" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Libero</strong> and <strong class="markup--strong markup--li-strong">Nate</strong></li></ul><p name="b18a" id="b18a" class="graf graf--p graf-after--li">Unfortunately, but not surprisingly, webmails like Gmail, Outlook.com or Yahoo don’t show any support for <code class="markup--code markup--p-code">@supports</code>.</p><p name="0ef0" id="0ef0" class="graf graf--p graf-after--p">But even in supporting clients, there’s a huge trap in using <code class="markup--code markup--p-code">@supports</code> in emails.</p><h3 name="917c" id="917c" class="graf graf--h3 graf-after--p">The trap</h3><p name="38c5" id="38c5" class="graf graf--p graf-after--h3">In order to get <code class="markup--code markup--p-code">@supports</code> to work in an email, you need both the email client itself and is rendering engine to support it.</p><p name="283c" id="283c" class="graf graf--p graf-after--p">By email client itself, I mean any filter, parsing or security rule that might remove certain CSS properties or features. For example, the desktop webmail of Gmail doesn’t any <code class="markup--code markup--p-code">position:absolute</code> declaration in CSS and will remove it from your code.</p><p name="2e17" id="2e17" class="graf graf--p graf-after--p">By rendering engine, I mean the actual HTML and CSS rendering engine used by the email client. So for an application like Apple Mail, it means WebKit. Or for the desktop Windows versions of Outlook, it means Word. For a webmail, it means the rendering engine used by the browser you’re using. So if you’re browsing Gmail in Chrome, the rendering engine is Blink. But if you’re browsing Gmail in Internet Explorer 11, the rendering engine is Trident.</p><p name="c77a" id="c77a" class="graf graf--p graf-after--p">And here’s the trap. Using <code class="markup--code markup--p-code">@supports</code> in emails will give you hints about the actual support by the rendering engine, but not by the email client itself.</p><p name="e006" id="e006" class="graf graf--p graf-after--p">For example, Orange’s desktop webmail doesn’t support the <code class="markup--code markup--p-code">overflow</code> property in CSS. But if you were to use a <code class="markup--code markup--p-code">@supports (overflow:auto)</code> query, there’s a good chance it will be validated as pretty much every browsers support <code class="markup--code markup--p-code">overflow</code> nowadays.</p><p name="254d" id="254d" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">@supports</code> is also not exempt of bugs and limitations, <a href="https://www.quirksmode.org/blog/archives/2016/07/the_limits_of_s.html" data-href="https://www.quirksmode.org/blog/archives/2016/07/the_limits_of_s.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">as noted by Peter-Paul Koch last year</a>. For example, <code class="markup--code markup--p-code">@supports (background-attachment:fixed)</code> returns true in Apple Mail, even though WebKit doesn’t support the <code class="markup--code markup--p-code">fixed</code> value for <code class="markup--code markup--p-code">background-attachment</code>.</p><h3 name="2b6d" id="2b6d" class="graf graf--h3 graf-after--p">Using <code class="markup--code markup--h3-code">@supports</code> as a targeting mechanism</h3><p name="06ef" id="06ef" class="graf graf--p graf-after--h3">With this mind, I would really recommend against using <code class="markup--code markup--p-code">@supports</code> blindly for feature support in HTML emails. However, I do think it’s interesting to use as a targeting mechanism. In fact, this is already <a href="https://emails.hteumeuleu.com/what-you-need-to-know-about-apple-mail-in-ios-10-c7031f6d704d" data-href="https://emails.hteumeuleu.com/what-you-need-to-know-about-apple-mail-in-ios-10-c7031f6d704d" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">what I suggested last year to target Apple Mail in iOS 10</a>. Because I know that WebKit only started to support four digits hexadecimals colors in iOS 10 (<em class="markup--em markup--p-em">ie</em> <code class="markup--code markup--p-code">#ffff</code>) and that the property <code class="markup--code markup--p-code">-webkit-overflow-scrolling</code> is only supported in iOS, I can use the following feature query.</p><pre name="8d8a" id="8d8a" class="graf graf--pre graf-after--p">@supports (-webkit-overflow-scrolling:touch) and (color:#ffff) {<br>  …<br>}</pre><p name="037e" id="037e" class="graf graf--p graf-after--pre">It’s not perfect by any means though. A webmail or email app that supports both these things and feature queries would also be targeted.</p><h3 name="63a7" id="63a7" class="graf graf--h3 graf-after--p">Using @media to fake @supports</h3><p name="2315" id="2315" class="graf graf--p graf-after--h3">A little known feature in WebKit is that, well before feature queries became a thing, you could use <code class="markup--code markup--p-code">@media</code> queries to detect support for certain CSS features. Actually, this worked for four CSS properties (<a href="https://developer.mozilla.org/fr/docs/Web/CSS/@media" data-href="https://developer.mozilla.org/fr/docs/Web/CSS/@media" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">as described on MDN</a>) :</p><ul class="postList"><li name="8056" id="8056" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">-webkit-animation</code></li><li name="1039" id="1039" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">-webkit-transition</code></li><li name="e08e" id="e08e" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">-webkit-transform-2d</code></li><li name="bab9" id="bab9" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">-webkit-transform-3d</code></li></ul><p name="832b" id="832b" class="graf graf--p graf-after--li">Here’s an example of it in action :</p><pre name="985a" id="985a" class="graf graf--pre graf-after--p">@media (-webkit-transform-2d) {<br>   …<br>}</pre><p name="c011" id="c011" class="graf graf--p graf-after--pre">What’s really interesting is that while <code class="markup--code markup--p-code">-webkit-animation</code>, <code class="markup--code markup--p-code">-webkit-transition</code> and <code class="markup--code markup--p-code">-webkit-transform-2d</code> media queries only work in WebKit, <code class="markup--code markup--p-code">-webkit-transform-3d</code> media queries also work on Blink (Chrome) and Gecko (Firefox). I’m sure this might have something to do with prefix aliasing and the vendor prefix war. But maybe it could lead to some interesting use to target specific rendering engines or email clients. Unfortunately, from my tests, those media queries don’t have a much broader support than real feature queries in email clients.</p><p name="6023" id="6023" class="graf graf--p graf-after--p graf--trailing">Let me know if you find any interesting use for this!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@hteumeuleu" class="p-author h-card">Rémi Parmentier</a> on <a href="https://medium.com/p/495085641e87"><time class="dt-published" datetime="2017-10-10T12:14:18.798Z">October 10, 2017</time></a>.</p><p><a href="https://medium.com/@hteumeuleu/the-trap-of-using-supports-in-emails-495085641e87" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 9, 2020.</p></footer></article></body></html>